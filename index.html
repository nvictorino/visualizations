
<!DOCTYPE html>
<html>
<head>
<meta content="utf-8" http-equiv="encoding">
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex,nofollow">
  <meta name="googlebot" content="noindex,nofollow">
  <script type="text/javascript" src="//d3js.org/d3.v3.js"></script>
      <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
      <script type="text/javascript" src="https://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
      <script src="bootstrap.tooltip.js"></script>
      <script src="bootstrap.popover.js"></script>
      <script src="d3.layout.chord.sort.js"></script>
      <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>
  <style type="text/css">
 pre {
    display:none;
}
body {
    background: #fff;
    color: #333;
    width: 100%;
    font-family: 'Roboto Condensed', sans-serif;
}
.container {
}
.about_text {
    float:right;
    width: 400px;
    margin-right: 25px;
}
h1 {
    font-size: 64px;
    font-weight: 400;
    letter-spacing: -2px;
    line-height: 1em;
    margin: 10px 0px 20px 0px;
    font-family: 'Roboto Condensed', sans-serif;
    color: #000;
    text-align: center;
}
h1 strong {
    color: #45b8e2;
}
.by {
    font-size: 12px;
    color: #666;
    margin-left: 4px;
    letter-spacing: 0px;
    font-family: 'Roboto Condensed', sans-serif;
    font-weight: 200;
}
.by strong {
    font-weight: 400;
}
.by img {
    margin-bottom: -3px;
    margin-left: 5px;
}
h2 {
    margin-top: 28px;
    margin-left: 4px;
    font-size: 18px;
    font-family: 'Roboto Condensed', sans-serif;
    font-weight: 200;
    color: #fff;
}
p {
    margin-left: 4px;
    font-size: 14px;
    font-family: 'Roboto Condensed', sans-serif;
    font-weight: 200;
    color: #999;
}
.source {
    color: #999;
    font-size: 14px;
    font-weight: 200;
}
.more {
    font-style: italic;
    font-size: 12px;
    color: #666;
    margin-left: -5px;
}
.footer {
    bottom:10px;
    position: absolute;
    margin-top: 30px;
    line-height: 18px;
    margin-right: 10px;
}
.icons {
    width: 400px;
}
.icons .image {
    width: 96px;
    text-align: center;
    display: inline-block;
    margin-right:0px;
    font-family: 'Roboto Condensed', sans-serif;
    font-weight: 200;
    color: #999;
    font-size: 10px;
    letter-spacing: 1px;
    text-transform: uppercase;
}
.icons .image img {
    width: 100%;
    margin-bottom: 10px;
}
.icons a {
    border: none;
}
.icons a:hover {
}
.icons p {
    font-size: 18px;
    font-weight: 400;
    color: #fff;
    letter-spacing: 2px;
}
.icons span {
    font-family: 'Roboto Condensed', sans-serif;
    font-size: 12px;
    font-weight: 200;
    color: #fff;
    letter-spacing: 2px;
    color: #999;
}
.icons .disclaimer {
    font-family: 'Roboto Condensed', sans-serif;
    font-size: 9px;
    font-weight: 200;
    letter-spacing: 1px;
    color: #666;
    text-align: center;
    font-style: italic;
    margin-top: 18px;
}
#chart_placeholder {
    text-align: center;
    color:#fff;
}
.dependencyWheel {
    font: 10px sans-serif;
}
form .btn-primary {
    margin-top: 25px;
}
.labeltext {
    color: #fff;
}
#circle circle {
    fill: none;
    pointer-events: all;
}
path.chord {
    transition: opacity 0.3s;
}
 #circle:hover path.fade {
    opacity: 0;
}
a {
    text-decoration: none;
    border-bottom: 1px dotted #666;
    color: #999;
}
.more a {
    color: #666;
}
.by a {
    color: #fff;
}
a:hover {
    color: #45b8e2;
}
a:not(:hover) {
    text-decoration: none;
}
text {
    fill: #000;
    font-weight:bold;
    font-size:10px;
}
svg {
    font-size: 12px;
    color: #999;
    font-family: 'Roboto Condensed', sans-serif;
    min-height: 100%;
    min-width: 100%;
}
.buttons-container {
    text-align: center;
        margin-top: 70px;
    display: block;
}


.d3-tip {
  line-height: 1;
  padding: 6px;
  background: white;
  border-radius: 1px solid black;
  font-size: 12px;
}
        .textbox path {
                stroke: #ffffff;
                stroke-width: 2;
                fill: none;
            }
#tipDiv {
    float:left;
    display:block;
    float: left;
}
.textbox {
    float:left;
    display:block;
    width:150px;
    margin-left: 20px;
}

div.tooltip2 {
    visibility: hidden;
    background: #478AC9;
    position: absolute;
    color: #000;
    padding:15px 0 0 15px;
    box-shadow: 2px 2px 15px #888888;
    font-family: 'Roboto Condensed', sans-serif;
    opacity: .9;
}
div.block {
    height: 100px;
    background:lightyellow;
}
tspan{
  font-weight: normal
}
path.domain {
    position: relative;
    right:10px;
  fill: none;
  stroke: #004ecc;
  stroke-width: 1;
}
.yaxis path.domain {
    stroke-width: 0;
}
.xaxis path.domain {
    transform: translate(-15px, -2px);
    stroke: #ffffff;
    stroke-width: 2;
}
.tick line {
    stroke: #ffffff;
    stroke-width: .5;
}
#lineChart {
    float:left;
    display: inline-block;
    border-left:1px dotted white;;

}
#lineChart svg > path {
  fill: none;
  stroke: #fff;
  stroke-width: 2;
}
#lineChart text {
  fill: #fff;
}


  </style>

<title></title>



  
</head>

<body>



<div class="tooltip2">
    <div id='countryName'></div>
    <div id='tipDiv'></div>
    <p class='textbox'></p>
    <div id="lineChart"></div>
</div>
<div class="container">
    <h1>Voluntary Contributions:</br> Donors and Recipients 2016</h1>
    <div class="buttons-container">
        <button class="btn btn-default btn-lg" id="byRegionButton">by Region</button>
        <button class="btn btn-default btn-lg" id="byCountryButton">by Country</button>
    </div>

    <!-- <button id="AllTripsButton" disabled="true" >by Region</button> -->

    <div id="chart_placeholder"></div>


</div>

<!-- Your data files can't be accessed from jsfiddle,so I'm storing 
     the data as <pre> blocks,and using text parsing functions in the
     code instead of file-accessing functions. -->
<pre id="neighborhoods">
name,color,category,figure,trend1,trend2,trend3
United States,#478AC9,donor,8,30,40,49
United Kingdom,#89C0E9,donor,74,39,43,42
Sweden,#ADD5E1,donor,41,32,27,37
European Commission,#478AC9,donor,0,24,19,21
Germany,#89C0E9,donor,15,8,9,15
Norway,#ADD5E1,donor,57,17,13,15
Switzerland,#478AC9,donor,23,9,8.5,9.5
Japan,#89C0E9,donor,8,6,9,9
Belgium,#ADD5E1,donor,29,3,3.7,8.2
Australia,#478AC9,donor,87,11.7,9.4,7.3
Canada,#89C0E9,donor,24,9,5,6
Netherlands,#ADD5E1,donor,96,6.5,8.75,6
Ireland,#478AC9,donor,91,3,3,5.5
Denmark,#89C0E9,donor,100,5.5,4.8,4.5
Finland,#ADD5E1,donor,100,4,3.8,3.8
New Zealand,#478AC9,donor,100,4.2,4,3.5
Spain,#89C0E9,donor,80,0.6,0.6,1.4
Korea Republic of,#ADD5E1,donor,74,0.9,1.5,1.3
France,#478AC9,donor,100,1.4,1,1
Russian Federation,#89C0E9,donor,59,0.9,1,0.8
Other Donors,#ADD5E1,donor,11,8.37,8.78,3.81
Eritrea,#F58233,recipient,90,30,40,49
Regional Office for the Caucasus and Central Asia,#FEDBB4,recipient,79,30,40,49
Liaison Offices,#FBB674,recipient,98,30,40,49
Philippines,#F58233,recipient,100,30,40,49
Regional Office for Latin America and the Caribbean,#FEDBB4,recipient,85,30,40,49
Regional Office for the Pacific,#FBB674,recipient,99,30,40,49
CÃ´te d'Ivoire,#F58233,recipient,87,30,40,49
Colombia,#FEDBB4,recipient,84,30,40,49
Burundi,#FBB674,recipient,73,30,40,49
Regional Office for Eastern Africa,#F58233,recipient,87,30,40,49
Regional Office for the Middle East and North Africa,#FEDBB4,recipient,89,30,40,49
Haiti,#FBB674,recipient,85,30,40,49
Regional Office for Southern Africa,#F58233,recipient,66,30,40,49
Mali,#FEDBB4,recipient,90,30,40,49
Myanmar,#FBB674,recipient,97,30,40,49
Pakistan,#F58233,recipient,99,30,40,49
Regional Office for Asia and the Pacific,#FEDBB4,recipient,77,30,40,49
Niger,#FBB674,recipient,93,30,40,49
Central African Republic,#F58233,recipient,86,30,40,49
Chad,#FEDBB4,recipient,91,30,40,49
Ukraine,#FBB674,recipient,81,30,40,49
Afghanistan,#F58233,recipient,99,30,40,49
OPT,#FEDBB4,recipient,90,30,40,49
Nigeria,#FBB674,recipient,86,30,40,49
Regional Office for West and Central Africa,#F58233,recipient,89,30,40,49
Somalia,#FEDBB4,recipient,97,30,40,49
Yemen,#FBB674,recipient,99,30,40,49
Democratic Republic of Congo,#F58233,recipient,95,30,40,49
Sudan,#FEDBB4,recipient,98,30,40,49
South Sudan,#FBB674,recipient,99,30,40,49
Ethiopia,#F58233,recipient,89,30,40,49
Iraq,#FEDBB4,recipient,101,30,40,49
CHF Management Units,#FBB674,recipient,83,30,40,49
Syria,#F58233,recipient,103,30,40,49
Headquarter Activities,#FEDBB4,recipient,95,30,40,49
Unearmarked,#FBB674,recipient,100,30,40,49
</pre>

<pre id="neighborhoods2">
name,color,category,figure,trend1,trend2,trend3
United States,#478AC9,donor,8,30,40,49
United Kingdom,#89C0E9,donor,74,39,43,42
Sweden,#ADD5E1,donor,41,32,27,37
European Commission,#478AC9,donor,0,24,19,21
Germany,#89C0E9,donor,15,8,9,15
Norway,#ADD5E1,donor,57,17,13,15
Switzerland,#478AC9,donor,23,9,8.5,9.5
Japan,#89C0E9,donor,8,6,9,9
Belgium,#ADD5E1,donor,29,3,3.7,8.2
Australia,#478AC9,donor,87,11.7,9.4,7.3
Canada,#89C0E9,donor,24,9,5,6
Netherlands,#ADD5E1,donor,96,6.5,8.75,6
Ireland,#478AC9,donor,91,3,3,5.5
Denmark,#89C0E9,donor,100,5.5,4.8,4.5
Finland,#ADD5E1,donor,100,4,3.8,3.8
New Zealand,#478AC9,donor,100,4.2,4,3.5
Spain,#89C0E9,donor,80,0.6,0.6,1.4
Korea Republic of,#ADD5E1,donor,74,0.9,1.5,1.3
France,#478AC9,donor,100,1.4,1,1
Russian Federation,#89C0E9,donor,59,0.9,1,0.8
Other Donors,#ADD5E1,donor,11,8.37,8.78,3.81
Liaison Offices,#F58233,recipient,98,30,40,49
Latin America and the Caribbean,#F58233,recipient,84,30,40,49
Asia,#FEDBB4,recipient,98,30,40,49
Europe,#FBB674,recipient,81,30,40,49
CHF Management Units,#F58233,recipient,83,30,40,49
Regional Offices,#FEDBB4,recipient,83,30,40,49
Headquarters,#FBB674,recipient,95,30,40,49
Mid-East & Northern/Central Asia,#F58233,recipient,95,30,40,49
Africa,#FEDBB4,recipient,93,30,40,49
Unearmarked,#FBB674,recipient,100,30,40,49
</pre>

<pre id="all_trips">
[
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.5,    0.7,    0.25,   0.6,    0.7,    0,  0,  0.5,    0.5,    0.5,    0.55,   1.1,    0.5,    0.4,    0.3,    0.8,    0,  1,  0.5,    0.4,    0.5,    0,  2,  1.15,   1.5,    1.2,    1,  1.5,    2.5,    1.8,    2,  0,  3,  17.67,  3.7],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.84525358, 0,  0.15267176, 0.878477306,    0,  0,  0,  0.15267176, 0,  0.15267176, 0,  0.15267176, 0,  0.78369906, 1.03761349, 0,  0,  0,  3.61463063, 0,  0,  2.85714286, 0.19083969, 31.5552824],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.55163283, 0,  0,  0.56955777, 0.11778563, 0.23857807, 1.10326567, 0.4592312,  0.23857807, 0.23857807, 0.47715615, 0.78124844, 0,  0.4592312,  0.4592312,  0.23857807, 0.71573422, 1.24944211, 1.04950916, 1.24944211, 0.23857807, 0.7902109,  0.33994217, 1.4521703,  0.9543123,  0.57852024, 0.35786711, 2.80297652, 0.4592312,  0.81709832, 0.23857807, 0.35786711, 0,  1.85484978, 0.23857807, 14.95394186],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.17006803, 0,  0,  0.33975085, 0.32894736, 0,  0.32786885, 0,  0,  0.45351474, 0.56625141, 1.10987791, 0,  0.16910936, 1.4573676,  0.85034014, 0.34013605, 1.54149137, 1.13250284, 0.56369786, 1.02676061, 0.8918617591,   1.13250284, 0.82236842, 3.03017173, 0.8361204014,   1.13378685, 1.36054421, 0,  1.67597763, 0,  0],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.55865922, 0,  0,  0,  0.55865922, 0,  0,  0,  0.53078556, 0,  0.53078556, 1.67597765, 0.55865922, 0.55865922, 0,  0,  1.11731843, 0.55865922, 0,  0,  0,  0.55865922, 1.94427641, 0,  1.11731843, 2.68502248, 2.29609545],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.11800802, 0,  0,  0,  0.23872265, 0,  0.2870085,  0.11800802, 0.23601605, 0.46728972, 0.31115143, 0.11800802, 0,  0,  0,  0.58411215, 0.58411215, 0.58411215, 0.46728972, 0,  2.34949014, 0,  8.4124504266],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.30832477, 0,  0,  0.51387461, 0,  0,  0,  0.60418276, 0,  0,  0,  0,  0,  0.30832477, 0,  0.51387461, 0,  0.82219938, 0,  0,  0.41109969, 0.80557701, 0.41109969, 0,  0,  0,  0.91250753, 1.7787342036,   2.17391304],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.32,   0,  0,  0,  0.5,    0,  0,  0,  0,  0,  0.1,    0,  0,  1,  0,  1,  0,  5,  0.1,    0.658075],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.16722408, 0,  0,  0,  0,  0,  0,  0,  0,  0.66889632, 0,  0.4180602,  0,  0,  0.8361204,  0,  0.6270903,  0,  0.8361204,  0.6270903,  0,  0.8361204,  0,  0.8361204,  0,  0,  0,  2.43770314],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.15232292, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.82434546, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  6.36069114],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.07490637, 0.08739076, 0,  0.03121099, 0.08739076, 0,  0,  0,  0.08739076, 0,  0.03121099, 0.07490637, 0,  0.07490637, 0.03121099, 0.2247191,  0.03121097, 0.18726592, 0.37453184, 0.38343558, 0.18102372, 0.03121099, 0.29962547, 0,  0.37453184, 0,  0.37453184, 0,  0.37369208, 0,  1.12107624, 0,  1.43163923],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.22593395, 5.66893424],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.1114827202,   0,  0,  0,  0,  0,  0,  0,  0,  0,  0.21231423, 0,  0,  0,  0,  0,  0,  0,  0.1910828,  0,  0,  0,  0,  4.95760937],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  4.4603033],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  3.79198267],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  3.46260388],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.27746948, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1.10987791],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.25,   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.1,    0,  1],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  1.13250283],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.35,   0.5],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.1,    0,  0,  0,  0,  0,  0,  0,  0,  0.02759382, 0.23236155, 0,  0,  0,  0,  0.004,  0,  0,  0,  0.08779888, 0,  0.004,  0,  0.004,  0,  0,  0,  0,  0.004,  0,  0.71835568, 11.18682386,    0.86885125, 0.31339007, 1.69772705],
[0, 0,  0.55163283, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.5,   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.1,    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.7,   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.25,  0,  0.56955777, 0,  0,  0,  0,  0,  0,  0,  0.07490637, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.6,   0,  0.11778563, 0.17006803, 0,  0,  0,  0,  0,  0,  0.08739076, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.7,   0,  0.23857807, 0,  0,  0,  0,  0,  0,  0.15232292, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0, 0,  1.10326567, 0,  0,  0,  0,  0,  0,  0,  0.03121099, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0, 0,  0.4592312,  0.33975085, 0,  0,  0.30832477, 0,  0,  0,  0.08739076, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.5,   0,  0.23857807, 0.32894736, 0,  0,  0,  0,  0.16722408, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.5,   0,  0.23857807, 0,  0.55865922, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.5,   0,  0.47715615, 0.32786885, 0,  0,  0.51387461, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.02759382, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.55,  0,  0.78124844, 0,  0,  0,  0,  0,  0,  0,  0.08739076, 0,  0,  0,  0,  0,  0.27746948, 0,  0,  0,  0.23236155, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[1.1,   0.84525358, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0.1114827202,   0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.5,   0,  0.4592312,  0.45351474, 0.55865922, 0.11800802, 0,  0,  0,  0,  0.03121099, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.4,   0.15267176, 0.4592312,  0.56625141, 0,  0,  0.60418276, 0,  0,  0,  0.07490637, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.3,   0.878477306,    0.23857807, 1.10987791, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.8,   0,  0.71573422, 0,  0,  0,  0,  0.32,   0,  0.82434546, 0.07490637, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0.004,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0, 0,  1.24944211, 0.16910936, 0.53078556, 0.23872265, 0,  0,  0.66889632, 0,  0.03121099, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[1, 0,  1.04950916, 1.4573676,  0,  0,  0,  0,  0,  0,  0.2247191,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.5,   0.15267176, 1.24944211, 0.85034014, 0.53078556, 0.2870085,  0,  0,  0.4180602,  0,  0.03121097, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.4,   0,  0.23857807, 0.34013605, 1.67597765, 0.11800802, 0.30832477, 0.5,    0,  0,  0.18726592, 0,  0,  0,  0,  0,  0,  0.25,   0,  0,  0.08779888, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0.5,   0.15267176, 0.7902109,  1.54149137, 0.55865922, 0.23601605, 0,  0,  0,  0,  0.37453184, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0, 0,  0.33994217, 1.13250284, 0.55865922, 0.46728972, 0.51387461, 0,  0.8361204,  0,  0.38343558, 0,  0.21231423, 0,  0,  0,  0,  0,  0,  0,  0.004,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[2, 0.15267176, 1.4521703,  0.56369786, 0,  0.31115143, 0,  0,  0,  0,  0.18102372, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[1.15,  0,  0.9543123,  1.02676061, 0,  0.11800802, 0.82219938, 0,  0.6270903,  0,  0.03121099, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0.004,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[1.5,   0.78369906, 0.57852024, 0.8918617591,   1.11731843, 0,  0,  0,  0,  0,  0.29962547, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[1.2,   1.03761349, 0.35786711, 1.13250284, 0.55865922, 0,  0,  0.1,    0.8361204,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[1, 0,  2.80297652, 0.82236842, 0,  0,  0.41109969, 0,  0.6270903,  0,  0.37453184, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[1.5,   0,  0.4592312,  3.03017173, 0,  0.58411215, 0.80557701, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[2.5,   0,  0.81709832, 0.8361204014,   0,  0.58411215, 0.41109969, 1,  0.8361204,  0,  0.37453184, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0.004,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[1.8,   3.61463063, 0.23857807, 1.13378685, 0.55865922, 0.58411215, 0,  0,  0,  0,  0,  0,  0.1910828,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[2, 0,  0.35786711, 1.36054421, 1.94427641, 0.46728972, 0,  1,  0.8361204,  0,  0.37369208, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0.71835568, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[0, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  11.18682386,    0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[3, 2.85714286, 1.85484978, 1.67597763, 1.11731843, 2.34949014, 0.91250753, 5,  0,  0,  1.12107624, 0,  0,  0,  0,  0,  0,  0.1,    0,  0,  0.86885125, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[17.67, 0.19083969, 0.23857807, 0,  2.68502248, 0,  1.7787342036,   0.1,    0,  0,  0,  0.22593395, 0,  0,  0,  0,  0,  0,  0,  0.35,   0.31339007, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
[3.7,   31.5552824, 14.95394186,    0,  2.29609545, 8.4124504266,   2.17391304, 0.658075,   2.43770314, 6.36069114, 1.43163923, 5.66893424, 4.95760937, 4.4603033,  3.79198267, 3.46260388, 1.10987791, 1,  1.13250283, 0.5,    1.69772705, 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0]
]
</pre>

<pre id="women_trips">
[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.7,0.6,0.7,0.4,0,5.9,17.7,7,12.8,3.7],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2,0,0,0.8,0.2,4.9,4.7,31.6],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.2,1,0.2,0,2.7,0.2,3.9,12.2,15],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.3,0.6,0.3,0,1.5,0,8,10.5,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.7,0,0.6,2.7,4.7,3.3,2.3],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.1,0,0.1,0,3.5,2.7,8.4],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.3,0.6,0.3,0,1.3,1.8,1.4,1.6,2.2],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.5,0,0.3,0.1,6.1,1,0.7],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.6,0,2.5,2.7,2.4],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,6.4],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2,0.1,0.2,0,0.2,0,2.3,1.6,1.4],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2,0,0,5.7],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.1,0,0.2,0.2,5],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4.5],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3.8],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3.5],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.3,0,0,0,0,0,0,0,1.1],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.3,0,0,0,0.1,0,1],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.1],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.4,0,0,0.5],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2,0,0.1,11.2,0.1,0.3,1.6,0,1.7],
[0.7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.6,0,1.2,0.3,0,0,0.3,0,0,0,0.2,0,0,0,0,0,0.3,0,0,0,0.2,0,0,0,0,0,0,0,0,0,0],
[0.7,0.2,1,0.6,0,0,0.6,0,0,0,0.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.4,0,0.2,0.3,1.7,0.1,0.3,0.5,0,0,0.2,0,0,0,0,0,0,0.3,0,0,0.1,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11.2,0,0,0,0,0,0,0,0,0,0],
[5.9,0.8,2.7,1.5,0.6,0.1,1.3,0.3,0.6,1,0.2,0,0.1,0,0,0,0,0,0,0,0.1,0,0,0,0,0,0,0,0,0,0],
[17.7,0.2,0.2,0,2.7,0,1.8,0.1,0,0,0,0.2,0,0,0,0,0,0,0,0.4,0.3,0,0,0,0,0,0,0,0,0,0],
[7,4.9,3.9,8,4.7,3.5,1.4,6.1,2.5,0,2.3,0,0.2,0,0,0,0,0.1,0,0,1.6,0,0,0,0,0,0,0,0,0,0],
[12.8,4.7,12.2,10.5,3.3,2.7,1.6,1,2.7,0,1.6,0,0.2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[3.7,31.6,15,0,2.3,8.4,2.2,0.7,2.4,6.4,1.4,5.7,5,4.5,3.8,3.5,1.1,1,1.1,0.5,1.7,0,0,0,0,0,0,0,0,0,0]]
</pre>
<script type='text/javascript'>//<![CDATA[

$(window).resize(function(){location.reload();});

window.onload=function(){
/*** Define parameters and tools ***/


var element = d3.select('#chart_placeholder').node();
var elementWH = element.getBoundingClientRect().width;

var width = elementWH,
    height = elementWH,
    outerRadius = Math.min(width,height) / 2.2 - 100,
    innerRadius = outerRadius - 19;

var opacityDefault = 0.8;


var dataset = "#all_trips";
//string url for the initial data set
//would usually be a file path url,here it is the id
//selector for the <pre> element storing the data

//create number formatting functions
var formatPercent = d3.format("%");
var numberWithCommas = d3.format("0,f");
var decimalPlaceLimit = d3.format("0,.2f")

//create the arc path data generator for the groups
var arc = d3.svg.arc()
    .innerRadius(innerRadius*1.01)
    .outerRadius(outerRadius);

//create the chord path data generator for the chords
var path = d3.svg.chord()
    .radius(innerRadius);

//define the default chord layout parameters
//within a function that returns a new layout object;
//that way,you can create multiple chord layouts
//that are the same except for the data.
function getDefaultLayout() {
    return customChordLayout()
    .padding(0.01)
    .sortSubgroups(d3.descending)
    .sortChords(d3.descending);
}  
var last_layout; //store layout between updates
var neighborhoods; //store neighbourhood data outside data-reading function

/*** Initialize the visualization ***/
var g = d3.select("#chart_placeholder").append("svg")
        .attr("width",width)
        .attr("height",height)
    .append("g")
        .attr("id","circle")
        .attr("transform",
              "translate(" + width / 2 + "," + height / 2 + ")");
//the entire graphic will be drawn within this <g> element,
//so all coordinates will be relative to the center of the circle

g.append("circle")
    .attr("r",outerRadius);
//this circle is set in CSS to be transparent but to respond to mouse events
//It will ensure that the <g> responds to all mouse events within
//the area,even after chords are faded out.





/* Create OR update a chord layout from a data matrix */
function updateChords( datasetURL ) {
    
    d3.selectAll("path.chord").remove()
    d3.selectAll("g.group").remove()
    var matrix = JSON.parse( d3.select(datasetURL).text() );
        // instead of d3.json
    /* Compute chord layout. */
    layout = getDefaultLayout(); //create a new layout object
    layoutMatrix =layout.matrix(matrix);
    layoutMatrixChords = layoutMatrix.chords();

    d3.select(".d3-tip").remove()

    function getGradID(d){ return "linkGrad-" + d.source.index + "-" + d.target.index; }
    var grads = g.append("defs").selectAll("linearGradient")
    .data(layoutMatrix.chords())
    .enter().append("linearGradient")
    //Create a unique gradient id per chord: e.g. "chordGradient-0-4"
    .attr("id",function(d) { return getGradID(d); })
    //Instead of the object bounding box,use the entire SVG for setting locations
    //in pixel locations instead of percentages (which is more typical)
    .attr("gradientUnits","userSpaceOnUse")
    //The full mathematical formula to find the x and y locations of the Avenger's source chord
    .attr("x1",function(d,i) { 
        return innerRadius*Math.cos((d.source.endAngle-d.source.startAngle)/2+d.source.startAngle-Math.PI/2);
    })
    .attr("y1",function(d,i) { 
        return innerRadius*Math.sin((d.source.endAngle-d.source.startAngle)/2+d.source.startAngle-Math.PI/2);
    })
    //Find the location of the target Avenger's chord 
    .attr("x2",function(d,i) { 
        return innerRadius*Math.cos((d.target.endAngle-d.target.startAngle)/2+d.target.startAngle-Math.PI/2);
    })
    .attr("y2",function(d,i) { 
        return innerRadius*Math.sin((d.target.endAngle-d.target.startAngle)/2+d.target.startAngle-Math.PI/2);
    });

    grads.append("stop")
      .attr("offset","0%")
      .attr("stop-color",function (d) {
            return neighborhoods[d.source.index].color;
    });

    //Set the ending color (at 100%)
    grads.append("stop")
      .attr("offset","100%")
      .attr("stop-color",function (d) {
            return neighborhoods[d.target.index].color;
    });


    g.selectAll("path.chord")
      .data(layoutMatrix.chords())
      .enter().append("path")
      .attr("class","chord")
      .style("fill",function(d){ return "url(#" + getGradID(d) + ")"; })
      .style("opacity",opacityDefault)
      .attr("d",path)
        .on("mouseover",mouseoverChord)
        .on("mouseout",mouseoutChord);


    //Highlight hovered over chord
    function mouseoverChord(d,i) {
      //Decrease opacity to all
      g.selectAll("path.chord")
        .transition()
        .style("opacity",0.1);
      //Show hovered over chord with full opacity
      d3.select(this)
        .transition()
            .style("opacity",1);
      
      //Define and show the tooltip over the mouse location
      $(this).popover({
        placement: 'auto top',
        container: 'body',
        mouseOffset: 10,
        followMouse: true,
        trigger: 'hover',
        html : true,
        content: function() { 
          return "<p style='font-size: 14px; text-align: center; color:#000'><span style='font-weight:900'>" + neighborhoods[d.source.index].name + 
               "</span> has donated<span style='font-weight:900'> $" + d.source.value + "M USD</span> to <span style='font-weight:900'>" + neighborhoods[d.target.index].name  + "</p>"; }
      });
      $(this).popover('show');
    }//mouseoverChord

    //Bring all chords back to default opacity
    function mouseoutChord(d) {
      //Hide the tooltip
      $('.popover').each(function() {
        $(this).remove();
      }); 
      //Set opacity back to default for all
      g.selectAll("path.chord")
        .transition()
        .style("opacity",opacityDefault);
    }//function mouseoutChord

    /* Create/update "group" elements */
    var groupG = g.selectAll("g.group")
        .data(layout.groups(),function (d) {
            return d.index; 
            //use a key function in case the 
            //groups are sorted differently between updates
        });
    
    groupG.exit()
        .transition()
            .duration(1500)
            .attr("opacity",0)
            .remove(); //remove after transitions are complete
    
    var newGroups = groupG.enter().append("g")
        .attr("class","group");
    //the enter selection is stored in a variable so we can
    //enter the <path>,<text>,and <title> elements as well

    
    //Create the title tooltip for the new groups
    /* newGroups.append("title");
    
    groupG.select("title")
        .text(function(d,i) {
            return numberWithCommas(d.value) 
                + "M USD total";
        }); */

    //create the arc paths and set the constant attributes
    //(those based on the group index,not on the value)
    newGroups.append("path")
        .attr("id",function (d) {
            return "group" + d.index;
            //using d.index and not i to maintain consistency
            //even if groups are sorted
        })
        .style("fill",function (d) {
            return neighborhoods[d.index].color;
        });
    
    //update the paths to match the layout
    groupG.select("path") 
        .transition()
            .duration(1500)
            .attr("opacity",0.5) //optional,just to observe the transition
        .attrTween("d",arcTween( last_layout ))
            .transition().duration(100).attr("opacity",1) //reset opacity
        ;
    
    //create the group labels
    var groupLabel = newGroups.append("svg:text")
        .attr("xlink:href",function (d) {
            return "#group" + d.index;
        })
        .attr("id", function(d, i) { return "group" + d.index; })
        .attr("dy",".35em")
        .attr("color","#fff")
        .text(function (d) {
            return neighborhoods[d.index].name;
        })
    groupLabel.append('tspan')
        .text(function (d) {
            return ": $"+decimalPlaceLimit(d.value) + "M";
        })


    //position group labels to match layout
    groupG.select("text")
        .transition()
            .duration(1500)
            .attr("transform",function(d) {
                d.angle = (d.startAngle + d.endAngle) / 2;
                //store the midpoint angle in the data object
                
                return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")" +
                    " translate(" + (innerRadius + 26) + ")" + 
                    (d.angle > Math.PI ? " rotate(180)" : " rotate(0)"); 
                //include the rotate zero so that transforms can be interpolated
            })
            .attr("text-anchor",function (d) {
                return d.angle > Math.PI ? "end" : "begin";
            });


    /* Create/update the chord paths */
    var chordPaths = g.selectAll("path.chord")
        .data(layout.chords(),chordKey );
            //specify a key function to match chords
            //between updates
        

    //create the new chord paths
    var newChords = chordPaths.enter()
        .append("path")
        .attr("class","chord");
    
    // Add title tooltip for each new chord.
    newChords.append("title");

    //handle exiting paths:
    chordPaths.exit().transition()
        .duration(1500)
        .attr("opacity",0)
        .remove();

    //update the path shape
    chordPaths.transition()
        .duration(1500)
        .attr("opacity",0.5) //optional,just to observe the transition
        .style("fill",function (d) {
            return "url(#" + getGradID(d) + ")"; 
        })
        .attrTween("d",chordTween(last_layout))
        .transition().duration(100).attr("opacity",1) //reset opacity
    ;


    var tooltip2 = d3.select("div.tooltip2");
    groupG.on("mouseover",function(d) {

        chordPaths.classed("fade",function (p) {
            //returns true if *neither* the source or target of the chord
            //matches the group that has been moused-over
            return ((p.source.index != d.index) && (p.target.index != d.index));
        });
        g.selectAll("path.fade").transition().style("opacity",0);


        var tipSVG = tooltipGenerator(neighborhoods[d.index].figure, 100-neighborhoods[d.index].figure, "#tipDiv", neighborhoods[d.index].name, neighborhoods[d.index].figure, decimalPlaceLimit(d.value), ".textbox", neighborhoods[d.index].category,neighborhoods[d.index].trend1,neighborhoods[d.index].trend2,neighborhoods[d.index].trend3 );
        return tooltip2.style("visibility", "visible");


    })
    groupG.on("mousemove",function(d) {

        return tooltip2
            .style("top", (d3.event.pageY + 16) + "px")
            .style("left", (d3.event.pageX  - 200) + "px");
    });
    groupG.on("mouseout",function(d) {
       
        $( "#tipDiv" ).empty();
        $( "#lineChart" ).empty();

        
        chordPaths.classed("nofade",function (p) {
            //returns true if *neither* the source or target of the chord
            //matches the group that has been moused-over
            return ((p.source.index != d.index) && (p.target.index != d.index));
        });
        g.selectAll("path.nofade").transition().style("opacity",1);
     return tooltip2.style("visibility", "hidden");

    });
    //the "unfade" is handled with CSS :hover class on g#circle
    //you could also do it using a mouseout event:
    /*
    g.on("mouseout",function() {
        if (this == g.node() )
            //only respond to mouseout of the entire circle
            //not mouseout events for sub-components
            chordPaths.classed("fade",false);
    });
    */
    //Highlight hovered over chord

    last_layout = layout; //save for next update
    
//  }); //end of d3.json
}

function arcTween(oldLayout) {
    //this function will be called once per update cycle
    
    //Create a key:value version of the old layout's groups array
    //so we can easily find the matching group 
    //even if the group index values don't match the array index
    //(because of sorting)
    var oldGroups = {};
    if (oldLayout) {
        oldLayout.groups().forEach( function(groupData) {
            oldGroups[ groupData.index ] = groupData;
        });
    }
    
    return function (d,i) {
        var tween;
        var old = oldGroups[d.index];
        if (old) { //there's a matching old group
            tween = d3.interpolate(old,d);
        }
        else {
            //create a zero-width arc object
            var emptyArc = {startAngle:d.startAngle,
                            endAngle:d.startAngle};
            tween = d3.interpolate(emptyArc,d);
        }
        
        return function (t) {
            return arc( tween(t) );
        };
    };
}

function chordKey(data) {
    return (data.source.index < data.target.index) ?
        data.source.index  + "-" + data.target.index:
        data.target.index  + "-" + data.source.index;
    
    //create a key that will represent the relationship
    //between these two groups *regardless*
    //of which group is called 'source' and which 'target'
}
function chordTween(oldLayout) {
    //this function will be called once per update cycle
    //Create a key:value version of the old layout's chords array
    //so we can easily find the matching chord 
    //(which may not have a matching index)
    
    var oldChords = {};
    
    if (oldLayout) {
        oldLayout.chords().forEach( function(chordData) {
            oldChords[ chordKey(chordData) ] = chordData;
        });
    }
    
    return function (d,i) {
        //this function will be called for each active chord
        
        var tween;
        var old = oldChords[ chordKey(d) ];
        if (old) {
            //old is not undefined,i.e.
            //there is a matching old chord value
            
            //check whether source and target have been switched:
            if (d.source.index != old.source.index ){
                //swap source and target to match the new data
                old = {
                    source: old.target,
                    target: old.source
                };
            }
            
            tween = d3.interpolate(old,d);
        }
        else {
            //create a zero-width chord object
            var emptyChord = {
                source: { startAngle: d.source.startAngle,
                         endAngle: d.source.startAngle},
                target: { startAngle: d.target.startAngle,
                         endAngle: d.target.startAngle}
            };
            tween = d3.interpolate( emptyChord,d );
        }

        return function (t) {
            //this function calculates the intermediary shapes
            return path(tween(t));
        };
    };
}


function tooltipGenerator(pie1, pie2, target1, name, figure, total,target2, category, trend1, trend2, trend3) {
    var w = 100,                        //width
    h = 100,                            //height
    r = 50;                       //radius


 //builtin range of colors
 
    data = [{"value":pie1}, 
            {"value":pie2}];
    
    var vis = d3.select(target1)
        .append("svg:svg")              //create the SVG element inside the <body>
        .data([data])                   //associate our data with the document
            .attr("width", w)           //set the width and height of our visualization (these will be attributes of the <svg> tag
            .attr("height", h)
        .append("svg:g")                //make a group to hold our pie chart
            .attr("transform", "translate(" + r + "," + r + ")")    //move the center of the pie chart from 0, 0 to radius, radius

    if(category == "donor") {   
         var countryName = d3.select("#countryName")
        .html("<p style='text-align: left; '><span style='font-size: 23px; text-transform: uppercase;color: #264A6B; '>" 
                + name + "</span></p>");
    } else {
         var countryName = d3.select("#countryName")
        .html("<p style='text-align: left; '><span style='font-size: 23px; text-transform: uppercase;color: #fff; '>" 
                + name + "</span></p>");      
    }

    var arc = d3.svg.arc()              //this will create <path> elements for us using arc data
        .outerRadius(r);

    var pie = d3.layout.pie()           //this will create arc data for us given a list of values
        .value(function(d) { return d.value; });    //we must tell it out to access the value of each element in our data array

    var arcs = vis.selectAll("g.slice")     //this selects all <g> elements with class slice (there aren't any yet)
        .data(pie)                          //associate the generated pie data (an array of arcs, each having startAngle, endAngle and value properties) 
        .enter()                            //this will create <g> elements for every "extra" data element that should be associated with a selection. The result is creating a <g> for every object in the data array
            .append("svg:g")                //create a group to hold each slice (we will have a <path> and a <text> element associated with each slice)
                .attr("class", "slice");    //allow us to style things in the slices (like text)
    if(category == "donor") {   
        arcs.append("svg:path")
                .attr("fill", function(d, i) { 
                    if (i == 1) {
                        return "#ADD5E1"
                    } else {
                        return "#89C0E9"
                    }

                } ) 
                .attr("d", arc);
    } else {
         arcs.append("svg:path")
                .attr("fill", function(d, i) { 
                    if (i == 1) {
                        return "#FEDBB4"
                    } else {
                        return "#FBB674"
                    }

                } ) 
                .attr("d", arc);       
    }                              

        arcs.append("svg:text")                                     //add a label to each slice
                .attr("transform", function(d) {                    //set the label's origin to the center of the arc
                //we have to make sure to set these before calling arc.centroid
                d.innerRadius = 0;
                d.outerRadius = r;
                return "translate(" + arc.centroid(d) + ")";        //this gives us a pair of coordinates like [50, 50]
            })
            .attr("text-anchor", "middle")                          //center the text on it's origin
            .text(function(d, i) { return data[i].label; });        //get the label from our original data array
    if(category == "donor"){
        var text = d3.select(target2)
            .html("<p style='text-align: left; '><span style='font-size: 20px;color:#89C0E9; font-weight:bold'>" 
            + figure  + "% unearmarked</span> <br /><span style='font-size: 18px; color: #fff'>Contribution: <br /><strong>$" +
            total + "M</strong></span><br /><span style='font-size: 15px; color: #fff'>"+formatPercent(total/262.6)+" of total OCHA <br />donor income</span></p>");
        d3.select(".tooltip2").style("background-color","#478AC9").style("width","460px");
    } else {
        var text = d3.select(target2)
            .html("<p style='text-align: left; '><span style='font-size: 20px;color:#FBB674; font-weight:bold'>" 
            + figure  + "% rate of expenditure</span> <br /><span style='font-size: 18px; color: #fff'>Received: <br /><strong>$" +
            total + "M</strong></span><br /><span style='font-size: 15px; color: #fff'>"+formatPercent(total/262.6)+" of total OCHA <br />donor donations</span></p>");
        d3.select(".tooltip2").style("background-color","#F58233").style("width","300px");
    }

    if(category == "donor") {

        var sparkWidth = 200, sparkHeight = 170, sparkMargin = 25;

        var spark = d3.select("#lineChart").append("svg:svg").attr("width", sparkWidth-(sparkMargin*2)).attr("height", sparkHeight-(sparkMargin*2));


        // create a simple data array that we'll plot with a line (this array represents only the Y values, X will just be the index location)
        var d = [trend1, trend2, trend3];
        var years =[2014,2015,2016];
        var formatDay = function(d) {
            return years[d];      
        }

        // X scale will fit values from 0-10 within pixels 0-100
        var xScale = d3.scale.linear().domain([0,d.length]).range([sparkMargin+(sparkMargin*1.3),sparkWidth-sparkMargin]);
        // Y scale will fit values from 0-10 within pixels 0-100
        var yScale = d3.scale.linear().domain([50,0]).range([0,sparkHeight-(sparkMargin*3)]).nice();


        xAxis = d3.svg.axis().scale(xScale).tickSize(0).ticks(3).tickFormat(formatDay).tickSubdivide(true);
        yAxis = d3.svg.axis().scale(yScale).tickSize(1).ticks(4).orient("left").tickSubdivide(true).innerTickSize(-150);

        spark.append("svg:g")
        .call(xAxis).attr("transform", "translate(0," + (sparkHeight-sparkMargin*2.55) + ")").attr("class", "xaxis");
        spark.append("svg:g")
        .call(yAxis).attr("transform", "translate(" + (sparkMargin+17) + "," + 7.8 + ")").attr("class", "yaxis");


        // create a line object that represents the SVN line we're creating
        var line = d3.svg.line()
            // assign the X function to plot our line as we wish
            .x(function(d,i) { 
                
                return xScale(i); 
            })
            .y(function(d) { 

                return  yScale(d); 

            })
            // display the line by appending an svg:path element with the data line we created above
        spark.append("svg:path").attr("d", line(d));


        //d3.select("path.domain").attr("transform", "translate(" + -50 + "," + 20 + ")");
    } else {

    }

}


/* Activate the buttons and link to data sets */
d3.select("#byCountryButton").on("click",function () {
    neighborhoods = d3.csv.parse(d3.select("#neighborhoods").text());

    updateChords( "#all_trips" );
    disableButton(this);
});

d3.select("#byRegionButton").on("click",function() {
    neighborhoods = d3.csv.parse(d3.select("#neighborhoods2").text());

    updateChords( "#women_trips" );
    disableButton(this);
});

d3.select("#AllTripsButton").on("click",function() {
    updateChords( "#all_trips" );
    disableButton(this);
});
function disableButton(buttonNode) {
    d3.selectAll("button")
        .attr("disabled",function(d) {
            return this === buttonNode? "true": null;
        });
}

}//]]> 

$("document").ready(function() {
    setTimeout(function() {
        $("#byRegionButton").trigger('click');
    },10);
});


</script>
  
  <script>
  // tell the embed parent frame the height of the content
  if (window.parent && window.parent.parent){
    window.parent.parent.postMessage(["resultsFrame",{
      height: document.body.getBoundingClientRect().height,
      slug: "n0zu0b1q"
    }],"*")
  }
</script>

</body>

</html>

