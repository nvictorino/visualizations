
<!DOCTYPE html>
<html>
    <head>
        <meta content="utf-8" http-equiv="encoding">
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta name="robots" content="noindex,nofollow">
        <meta name="googlebot" content="noindex,nofollow">
        <script type="text/javascript" src="//d3js.org/d3.v3.js"></script>
        <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
        <link href="BootstrapXL.css" rel="stylesheet">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
        <script src="bootstrap.tooltip.js"></script>
        <script src="bootstrap.popover.js"></script>
        <script src="d3.layout.chord.sort.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet">
        <link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon">

        <style type="text/css">
        /* Global */
        pre {
            display:none;
        }
        body {
            background: #fff;
            color: #333;
            width: 100%;
            font-family: 'Roboto Condensed',sans-serif;
            overflow-x: hidden;
        }
        .container-fluid {
            margin-bottom:200px;
        }
        h1 {
            font-size: 44px;
            font-weight: 400;
            letter-spacing: -2px;
            line-height: 1em;
            margin: 10px 0px 20px 0px;
            color: #545454;
            text-align: center;
            text-transform: uppercase;
        }
        h2 {
            margin-top: 28px;
            margin-left: 4px;
            font-size: 18px;
            font-weight: 200;
            color: #fff;
        }
        p {
            margin-left: 4px;
            font-size: 14px;
            font-family: 'Roboto Condensed',sans-serif;
            font-weight: 200;
            color: #999;
        }

        /* Navbar */
        .navbar {
            font-size: 12px;
            padding-top: 10px;
            padding-bottom: 10px;
            border: none;
            margin-bottom: 70px;
            background: #418FDE;
            border-radius: 0; 
        }
        .navbar-brand {
            float: left;
            height: 69px;
            padding: 0;
            font-size: 18px;
            line-height: 20px;
        }

        /* Title */
        h1 strong {
            font-size:59px;
            margin-top:25px;
        }
        .blue {
            color:#478AC9;
        }
        .orange {
            color:#FBB674;
        }
        .next-line {
            display: block;
            margin-top:20px;
        }
        .buttons-container {
            text-align: center;
            margin-top: 70px;
            display: block;
        }


        /* Chart */
        #chart_placeholder {
            text-align: center;
            color:#fff;
        }
        svg {
            font-size: 12px;
            color: #999;
            min-height: 100%;
            min-width: 100%;
        }
            #circle circle {
                fill: none;
                pointer-events: all;
            }
            path.chord {
                transition: opacity 0.3s;
            }
             #circle:hover path.fade {
                opacity: 0;
            }
            text {
                fill: #545454;
                font-weight:bold;
                font-size:10px;
            }
            tspan{
              font-weight: normal
            }


        /* Tooltips */
        div.tooltip {
            visibility: hidden;
            background: #478AC9;
            position: absolute;
            color: #545454;
            padding:15px 0 0 15px;
            box-shadow: 2px 2px 15px #888888;
            font-family: 'Roboto Condensed',sans-serif;
            opacity: .9;
        }
            #tipDiv {
                float:left;
                display:block;
                float: left;
            }
            .textbox {
                float:left;
                display:block;
                width:150px;
                margin-left: 20px;
            }
                .textbox path {
                        stroke: #ffffff;
                        stroke-width: 2;
                        fill: none;
                }
            #lineChart {
                float:left;
                display: inline-block;
                height: 104px;
            }
            #lineChart svg > path {
              fill: none;
              stroke: #fff;
              stroke-width: 2;
            }
            #lineChart text {
              fill: #fff;
            }
            path.domain {
                position: relative;
                right:10px;
                fill: none;
                stroke: #004ecc;
                stroke-width: 1;
            }
            .yaxis path.domain {
                stroke-width: 0;
            }
            .xaxis path.domain {
                transform: translate(-15px,-2px);
                stroke: #ffffff;
                stroke-width: 2;
            }
            .tick line {
                stroke: #ffffff;
                stroke-width: .5;
            }
        </style>
        <title>UNOCHA: 2016 Voluntary Contributions</title>
</head>

<body>
<div class="tooltip">
    <div id='countryName'></div>
    <div id='tipDiv'></div>
    <p class='textbox'></p>
    <div id="lineChart"></div>
</div>
<nav class="navbar navbar-default">
    <div class="container navigation">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar top-bar"></span>
                <span class="icon-bar middle-bar"></span>
                <span class="icon-bar bottom-bar"></span>
            </button>
            <div class="navbar-brand">
                <div class="l-region l-region--branding">
                    <div class="panel-pane pane-page-logo">
                        <a href="http://www.unocha.org/" rel="home" id="logo" title="Home"><img src="http://www.unocha.org/sites/unocha/files/ochalogo_0.png" alt="Home"></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav>
<div class="container-fluid">
    <h1>2016 Voluntary Contributions by</br><span class="next-line"><strong><span class="blue">Donors</span></strong> and <strong><span class="orange">Recipients</span></strong></span></h1>
    <div class="buttons-container">
        <button class="btn btn-default btn-lg" id="byRegionButton">by Region</button>
        <button class="btn btn-default btn-lg" id="byCountryButton">by Country</button>
    </div>
    <div id="chart_placeholder"></div>
</div>

<pre id="countries">
name,color,category,figure,trend1,trend2,trend3
United States,#478AC9,donor,8,30,40,49
United Kingdom,#89C0E9,donor,74,39,43,42
Sweden,#ADD5E1,donor,41,32,27,37
European Commission,#478AC9,donor,0,24,19,21
Germany,#89C0E9,donor,15,8,9,15
Norway,#ADD5E1,donor,57,17,13,15
Switzerland,#478AC9,donor,23,9,8.5,9.5
Japan,#89C0E9,donor,8,6,9,9
Belgium,#ADD5E1,donor,29,3,3.7,8.2
Australia,#478AC9,donor,87,11.7,9.4,7.3
Canada,#89C0E9,donor,24,9,5,6
Netherlands,#ADD5E1,donor,96,6.5,8.75,6
Ireland,#478AC9,donor,91,3,3,5.5
Denmark,#89C0E9,donor,100,5.5,4.8,4.5
Finland,#ADD5E1,donor,100,4,3.8,3.8
New Zealand,#478AC9,donor,100,4.2,4,3.5
Spain,#89C0E9,donor,80,0.6,0.6,1.4
Korea Republic of,#ADD5E1,donor,74,0.9,1.5,1.3
France,#478AC9,donor,100,1.4,1,1
Russian Federation,#89C0E9,donor,59,0.9,1,0.8
Other Donors,#ADD5E1,donor,11,8.37,8.78,3.81
Eritrea,#F58233,recipient,90,30,40,49
Regional Office for the Caucasus and Central Asia,#FEDBB4,recipient,79,30,40,49
Liaison Offices,#FBB674,recipient,98,30,40,49
Philippines,#F58233,recipient,100,30,40,49
Regional Office for Latin America and the Caribbean,#FEDBB4,recipient,85,30,40,49
Regional Office for the Pacific,#FBB674,recipient,99,30,40,49
CÃ´te d'Ivoire,#F58233,recipient,87,30,40,49
Colombia,#FEDBB4,recipient,84,30,40,49
Burundi,#FBB674,recipient,73,30,40,49
Regional Office for Eastern Africa,#F58233,recipient,87,30,40,49
Regional Office for the Middle East and North Africa,#FEDBB4,recipient,89,30,40,49
Haiti,#FBB674,recipient,85,30,40,49
Regional Office for Southern Africa,#F58233,recipient,66,30,40,49
Mali,#FEDBB4,recipient,90,30,40,49
Myanmar,#FBB674,recipient,97,30,40,49
Pakistan,#F58233,recipient,99,30,40,49
Regional Office for Asia and the Pacific,#FEDBB4,recipient,77,30,40,49
Niger,#FBB674,recipient,93,30,40,49
Central African Republic,#F58233,recipient,86,30,40,49
Chad,#FEDBB4,recipient,91,30,40,49
Ukraine,#FBB674,recipient,81,30,40,49
Afghanistan,#F58233,recipient,99,30,40,49
OPT,#FEDBB4,recipient,90,30,40,49
Nigeria,#FBB674,recipient,86,30,40,49
Office for West and Central Africa,#F58233,recipient,89,30,40,49
Somalia,#FEDBB4,recipient,97,30,40,49
Yemen,#FBB674,recipient,99,30,40,49
Democratic Republic of Congo,#F58233,recipient,95,30,40,49
Sudan,#FEDBB4,recipient,98,30,40,49
South Sudan,#FBB674,recipient,99,30,40,49
Ethiopia,#F58233,recipient,89,30,40,49
Iraq,#FEDBB4,recipient,101,30,40,49
CHF Management Units,#FBB674,recipient,83,30,40,49
Syria,#F58233,recipient,103,30,40,49
Headquarter Activities,#FEDBB4,recipient,95,30,40,49
Unearmarked,#FBB674,recipient,100,30,40,49
</pre>

<pre id="regions">
name,color,category,figure,trend1,trend2,trend3
United States,#478AC9,donor,8,30,40,49
United Kingdom,#89C0E9,donor,74,39,43,42
Sweden,#ADD5E1,donor,41,32,27,37
European Commission,#478AC9,donor,0,24,19,21
Germany,#89C0E9,donor,15,8,9,15
Norway,#ADD5E1,donor,57,17,13,15
Switzerland,#478AC9,donor,23,9,8.5,9.5
Japan,#89C0E9,donor,8,6,9,9
Belgium,#ADD5E1,donor,29,3,3.7,8.2
Australia,#478AC9,donor,87,11.7,9.4,7.3
Canada,#89C0E9,donor,24,9,5,6
Netherlands,#ADD5E1,donor,96,6.5,8.75,6
Ireland,#478AC9,donor,91,3,3,5.5
Denmark,#89C0E9,donor,100,5.5,4.8,4.5
Finland,#ADD5E1,donor,100,4,3.8,3.8
New Zealand,#478AC9,donor,100,4.2,4,3.5
Spain,#89C0E9,donor,80,0.6,0.6,1.4
Korea Republic of,#ADD5E1,donor,74,0.9,1.5,1.3
France,#478AC9,donor,100,1.4,1,1
Russian Federation,#89C0E9,donor,59,0.9,1,0.8
Other Donors,#ADD5E1,donor,11,8.37,8.78,3.81
Liaison Offices,#F58233,recipient,98,30,40,49
Latin America and the Caribbean,#F58233,recipient,84,30,40,49
Asia,#FEDBB4,recipient,98,30,40,49
Europe,#FBB674,recipient,81,30,40,49
CHF Management Units,#F58233,recipient,83,30,40,49
Regional Offices,#FEDBB4,recipient,83,30,40,49
Headquarters,#FBB674,recipient,95,30,40,49
Mid-East & Northern/Central Asia,#F58233,recipient,95,30,40,49
Africa,#FEDBB4,recipient,93,30,40,49
Unearmarked,#FBB674,recipient,100,30,40,49
</pre>

<pre id="all_countries">
[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.5,0.7,0.25, 0.6,0.7,0,0,0.5,0.5,0.5,0.55, 1.1,0.5,0.4,0.3,0.8,0,1,0.5,0.4,0.5,0,2,1.15, 1.5,1.2,1,1.5,2.5,1.8,2,0,3,17.67,3.7],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.84525358,0,0.15267176,0.878477306,0,0,0,0.15267176,0,0.15267176,0,0.15267176,0,0.78369906,1.03761349,0,0,0,3.61463063,0,0,2.85714286,0.19083969,31.5552824],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.55163283,0,0,0.56955777,0.11778563,0.23857807,1.10326567,0.4592312,0.23857807,0.23857807,0.47715615,0.78124844,0,0.4592312,0.4592312,0.23857807,0.71573422,1.24944211,1.04950916,1.24944211,0.23857807,0.7902109,0.33994217,1.4521703,0.9543123,0.57852024,0.35786711,2.80297652,0.4592312,0.81709832,0.23857807,0.35786711,0,1.85484978,0.23857807,14.95394186],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.17006803,0,0,0.33975085,0.32894736,0,0.32786885,0,0,0.45351474,0.56625141,1.10987791,0,0.16910936,1.4573676,0.85034014,0.34013605,1.54149137,1.13250284,0.56369786,1.02676061,0.8918617591, 1.13250284,0.82236842,3.03017173,0.8361204014, 1.13378685,1.36054421,0,1.67597763,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.55865922,0,0,0,0.55865922,0,0,0,0.53078556,0,0.53078556,1.67597765,0.55865922,0.55865922,0,0,1.11731843,0.55865922,0,0,0,0.55865922,1.94427641,0,1.11731843,2.68502248,2.29609545],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.11800802,0,0,0,0.23872265,0,0.2870085,0.11800802,0.23601605,0.46728972,0.31115143,0.11800802,0,0,0,0.58411215,0.58411215,0.58411215,0.46728972,0,2.34949014,0,8.4124504266],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.30832477,0,0,0.51387461,0,0,0,0.60418276,0,0,0,0,0,0.30832477,0,0.51387461,0,0.82219938,0,0,0.41109969,0.80557701,0.41109969,0,0,0,0.91250753,1.7787342036, 2.17391304],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.32, 0,0,0,0.5,0,0,0,0,0,0.1,0,0,1,0,1,0,5,0.1,0.658075],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.16722408,0,0,0,0,0,0,0,0,0.66889632,0,0.4180602,0,0,0.8361204,0,0.6270903,0,0.8361204,0.6270903,0,0.8361204,0,0.8361204,0,0,0,2.43770314],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.15232292,0,0,0,0,0,0,0,0,0,0,0.82434546,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6.36069114],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.07490637,0.08739076,0,0.03121099,0.08739076,0,0,0,0.08739076,0,0.03121099,0.07490637,0,0.07490637,0.03121099,0.2247191,0.03121097,0.18726592,0.37453184,0.38343558,0.18102372,0.03121099,0.29962547,0,0.37453184,0,0.37453184,0,0.37369208,0,1.12107624,0,1.43163923],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.22593395,5.66893424],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.1114827202, 0,0,0,0,0,0,0,0,0,0.21231423,0,0,0,0,0,0,0,0.1910828,0,0,0,0,4.95760937],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4.4603033],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3.79198267],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3.46260388],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.27746948,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.10987791],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.25, 0,0,0,0,0,0,0,0,0,0,0,0,0.1,0,1],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.13250283],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.35, 0.5],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.1,0,0,0,0,0,0,0,0,0.02759382,0.23236155,0,0,0,0,0.004,0,0,0,0.08779888,0,0.004,0,0.004,0,0,0,0,0.004,0,0.71835568,11.18682386,0.86885125,0.31339007,1.69772705],
[0,0,0.55163283,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.5, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.7, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.25,0,0.56955777,0,0,0,0,0,0,0,0.07490637,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.6, 0,0.11778563,0.17006803,0,0,0,0,0,0,0.08739076,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.7, 0,0.23857807,0,0,0,0,0,0,0.15232292,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,1.10326567,0,0,0,0,0,0,0,0.03121099,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0.4592312,0.33975085,0,0,0.30832477,0,0,0,0.08739076,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.5, 0,0.23857807,0.32894736,0,0,0,0,0.16722408,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.5, 0,0.23857807,0,0.55865922,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.5, 0,0.47715615,0.32786885,0,0,0.51387461,0,0,0,0,0,0,0,0,0,0,0,0,0,0.02759382,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.55,0,0.78124844,0,0,0,0,0,0,0,0.08739076,0,0,0,0,0,0.27746948,0,0,0,0.23236155,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[1.1, 0.84525358,0,0,0,0,0,0,0,0,0,0,0.1114827202, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.5, 0,0.4592312,0.45351474,0.55865922,0.11800802,0,0,0,0,0.03121099,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.4, 0.15267176,0.4592312,0.56625141,0,0,0.60418276,0,0,0,0.07490637,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.3, 0.878477306,0.23857807,1.10987791,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.8, 0,0.71573422,0,0,0,0,0.32, 0,0.82434546,0.07490637,0,0,0,0,0,0,0,0,0,0.004,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,1.24944211,0.16910936,0.53078556,0.23872265,0,0,0.66889632,0,0.03121099,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[1,0,1.04950916,1.4573676,0,0,0,0,0,0,0.2247191,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.5, 0.15267176,1.24944211,0.85034014,0.53078556,0.2870085,0,0,0.4180602,0,0.03121097,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.4, 0,0.23857807,0.34013605,1.67597765,0.11800802,0.30832477,0.5,0,0,0.18726592,0,0,0,0,0,0,0.25, 0,0,0.08779888,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.5, 0.15267176,0.7902109,1.54149137,0.55865922,0.23601605,0,0,0,0,0.37453184,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0.33994217,1.13250284,0.55865922,0.46728972,0.51387461,0,0.8361204,0,0.38343558,0,0.21231423,0,0,0,0,0,0,0,0.004,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[2,0.15267176,1.4521703,0.56369786,0,0.31115143,0,0,0,0,0.18102372,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[1.15,0,0.9543123,1.02676061,0,0.11800802,0.82219938,0,0.6270903,0,0.03121099,0,0,0,0,0,0,0,0,0,0.004,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[1.5, 0.78369906,0.57852024,0.8918617591, 1.11731843,0,0,0,0,0,0.29962547,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[1.2, 1.03761349,0.35786711,1.13250284,0.55865922,0,0,0.1,0.8361204,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[1,0,2.80297652,0.82236842,0,0,0.41109969,0,0.6270903,0,0.37453184,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[1.5, 0,0.4592312,3.03017173,0,0.58411215,0.80557701,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[2.5, 0,0.81709832,0.8361204014, 0,0.58411215,0.41109969,1,0.8361204,0,0.37453184,0,0,0,0,0,0,0,0,0,0.004,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[1.8, 3.61463063,0.23857807,1.13378685,0.55865922,0.58411215,0,0,0,0,0,0,0.1910828,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[2,0,0.35786711,1.36054421,1.94427641,0.46728972,0,1,0.8361204,0,0.37369208,0,0,0,0,0,0,0,0,0,0.71835568,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11.18682386,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[3,2.85714286,1.85484978,1.67597763,1.11731843,2.34949014,0.91250753,5,0,0,1.12107624,0,0,0,0,0,0,0.1,0,0,0.86885125,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[17.67,0.19083969,0.23857807,0,2.68502248,0,1.7787342036, 0.1,0,0,0,0.22593395,0,0,0,0,0,0,0,0.35, 0.31339007,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[3.7, 31.5552824,14.95394186,0,2.29609545,8.4124504266, 2.17391304,0.658075, 2.43770314,6.36069114,1.43163923,5.66893424,4.95760937,4.4603033,3.79198267,3.46260388,1.10987791,1,1.13250283,0.5,1.69772705,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]
</pre>

<pre id="all_regions">
[[0,  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.7,  0.55, 0.65, 0.4,  0,5.85, 17.67,7,12.8, 3.7],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.15267176,0,0,0.84525358,0.19083969,4.925905416,  4.70367321,31.5552824],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.24047964,1.02878897,0.23857807,0,2.74214444,0.23857807,3.93931514,12.2496758,14.95394186],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.33975085,0.56625141,0.34013605,0,1.52469749,0,7.9528968,10.5372862205,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.67597765,0,0.55865922,2.68502248,4.7375725,3.29620799,2.29609545],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.11800802,0,0.11800802,0,3.52008563,2.70722705,8.4124504266],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.30832477,0.60418276,0.30832477,0,1.33607399,1.7787342036, 1.42638214,1.62777639,2.17391304],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.5,  0,0.32, 0.1,  6.1,  1,0.658075],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.6270903,0,2.5083612,2.7173913,2.43770314],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.97666838,0,0,0,6.36069114],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.17478152,0.14981274,0.18726592,0,0.19350812,0,2.25273574,1.57927591,1.43163923],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.22593395,0,0,5.66893424],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.1114827202, 0,0.21231423,0.1910828,4.95760937],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4.4603033],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3.79198267],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3.46260388],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.27746948,0,0,0,0,0,0,0,1.10987791],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.25, 0,0,0,0.1,  0,1],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1.13250283],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.35, 0,0,0.5],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.23236155,0,0.08779888,11.18682386,  0.13559382,0.31339007,1.59120693,0.004,1.69772705],
[0.7, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.55,0,1.24047964,0.33975085,0,0,0.30832477,0,0,0,0.17478152,0,0,0,0,0,0.27746948,0,0,0,0.23236155,0,0,0,0,0,0,0,0,0,0],
[0.65,0.15267176,1.02878897,0.56625141,0,0,0.60418276,0,0,0,0.14981274,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0.4, 0,0.23857807,0.34013605,1.67597765,0.11800802,0.30832477,0.5,  0,0,0.18726592,0,0,0,0,0,0,0.25, 0,0,0.08779888,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11.18682386,  0,0,0,0,0,0,0,0,0,0],
[5.85,0.84525358,2.74214444,1.52469749,0.55865922,0.11800802,1.33607399,0.32, 0.6270903,0.97666838,0.19350812,0,0.1114827202, 0,0,0,0,0,0,0,0.13559382,0,0,0,0,0,0,0,0,0,0],
[17.67,0.19083969,0.23857807,0,2.68502248,0,1.7787342036, 0.1,  0,0,0,0.22593395,0,0,0,0,0,0,0,0.35, 0.31339007,0,0,0,0,0,0,0,0,0,0],
[7,4.925905416,  3.93931514,7.9528968,4.7375725,3.52008563,1.42638214,6.1,  2.5083612,0,2.25273574,0,0.21231423,0,0,0,0,0.1,  0,0,1.59120693,0,0,0,0,0,0,0,0,0,0],
[12.8,4.70367321,12.2496758,10.5372862205,3.29620799,2.70722705,1.62777639,1,2.7173913,0,1.57927591,0,0.1910828,0,0,0,0,0,0,0,0.004,0,0,0,0,0,0,0,0,0,0],
[3.7, 31.5552824,14.95394186,  0,2.29609545,8.4124504266, 2.17391304,0.658075, 2.43770314,6.36069114,1.43163923,5.66893424,4.95760937,4.4603033,3.79198267,3.46260388,1.10987791,1,1.13250283,0.5,  1.69772705,0,0,0,0,0,0,0,0,0,0]]
</pre>

<script type='text/javascript'>//<![CDATA[
// Reload and resize chart on window size change
$(window).resize(function(){location.reload();});

window.onload=function(){
var element = d3.select('#chart_placeholder').node();
var elementWH = element.getBoundingClientRect().width;
var width = elementWH,
    height = elementWH,
    outerRadius = Math.min(width,height) / 2.2 - 150,
    innerRadius = outerRadius - 19;
var opacityDefault = 0.8;

//create number formatting functions
var formatPercent = d3.format("%");
var numberWithCommas = d3.format("0,f");
var decimalPlaceLimit = d3.format("0,.2f");

//create the arc path data generator for the groups
var arc = d3.svg.arc()
    .innerRadius(innerRadius*1.01)
    .outerRadius(outerRadius);

//create the chord path data generator for the chords
var path = d3.svg.chord()
    .radius(innerRadius);

function getDefaultLayout() {
    return customChordLayout()
    .padding(0.01)
    .sortSubgroups(d3.descending)
    .sortChords(d3.descending);
}  
var last_layout; //store layout between updates
var countries; //store neighbourhood data outside data-reading function

/*** Initialize the visualization ***/
var g = d3.select("#chart_placeholder").append("svg")
        .attr("width",width)
        .attr("height",height)
    .append("g")
        .attr("id","circle")
        .attr("transform",
              "translate(" + width / 2 + "," + height / 2 + ")");

g.append("circle")
    .attr("r",outerRadius);

function updateChords( datasetURL ) {
    
    d3.selectAll("path.chord").remove()
    d3.selectAll("g.group").remove()
    var matrix = JSON.parse( d3.select(datasetURL).text() );

    layout = getDefaultLayout(); //create a new layout object
    layoutMatrix =layout.matrix(matrix);
    layoutMatrixChords = layoutMatrix.chords();

    // generates the gradients in the chords
    function getGradID(d){ return "linkGrad-" + d.source.index + "-" + d.target.index; }
    var grads = g.append("defs").selectAll("linearGradient")
    .data(layoutMatrix.chords())
    .enter().append("linearGradient")
    .attr("id",function(d) { return getGradID(d); })
    .attr("gradientUnits","userSpaceOnUse")
    .attr("x1",function(d,i) { 
        return innerRadius*Math.cos((d.source.endAngle-d.source.startAngle)/2+d.source.startAngle-Math.PI/2);
    })
    .attr("y1",function(d,i) { 
        return innerRadius*Math.sin((d.source.endAngle-d.source.startAngle)/2+d.source.startAngle-Math.PI/2);
    })
    .attr("x2",function(d,i) { 
        return innerRadius*Math.cos((d.target.endAngle-d.target.startAngle)/2+d.target.startAngle-Math.PI/2);
    })
    .attr("y2",function(d,i) { 
        return innerRadius*Math.sin((d.target.endAngle-d.target.startAngle)/2+d.target.startAngle-Math.PI/2);
    });

    grads.append("stop")
      .attr("offset","0%")
      .attr("stop-color",function (d) {
            return countries[d.source.index].color;
    });

    //Set the ending color (at 100%)
    grads.append("stop")
      .attr("offset","100%")
      .attr("stop-color",function (d) {
            return countries[d.target.index].color;
    });

    g.selectAll("path.chord")
      .data(layoutMatrix.chords())
      .enter().append("path")
      .attr("class","chord")
      .style("fill",function(d){ return "url(#" + getGradID(d) + ")"; })
      .style("opacity",opacityDefault)
      .attr("d",path)
        .on("mouseover",mouseoverChord)
        .on("mouseout",mouseoutChord);


    //Highlight hovered over chord
    function mouseoverChord(d,i) {
      //Decrease opacity to all
      g.selectAll("path.chord")
        .transition()
        .style("opacity",0.1);
      //Show hovered over chord with full opacity
      d3.select(this)
        .transition()
            .style("opacity",1);
      
      //Define and show the tooltip over the mouse location
      $(this).popover({
        placement: 'auto top',
        container: 'body',
        mouseOffset: 10,
        followMouse: true,
        trigger: 'hover',
        html : true,
        content: function() { 
          return "<p style='font-size: 14px; text-align: center; color:#545454'><span style='font-weight:900'>" + countries[d.source.index].name + 
               "</span> has donated<span style='font-weight:900'> $" + decimalPlaceLimit(d.source.value) + "M USD</span> to <span style='font-weight:900'>" + countries[d.target.index].name  + "</p>"; }
      });
      $(this).popover('show');
    }//mouseoverChord

    //Bring all chords back to default opacity
    function mouseoutChord(d) {
      //Hide the tooltip
      $('.popover').each(function() {
        $(this).remove();
      }); 
      //Set opacity back to default for all
      g.selectAll("path.chord")
        .transition()
        .style("opacity",opacityDefault);
    }//function mouseoutChord

    /* Create/update "group" elements */
    var groupG = g.selectAll("g.group")
        .data(layout.groups(),function (d) {
            return d.index; 
            //use a key function in case the 
            //groups are sorted differently between updates
        });
    
    groupG.exit()
        .transition()
            .duration(1500)
            .attr("opacity",0)
            .remove(); //remove after transitions are complete
    
    var newGroups = groupG.enter().append("g")
        .attr("class","group");

    newGroups.append("path")
        .attr("id",function (d) {
            return "group" + d.index;
            //using d.index and not i to maintain consistency
            //even if groups are sorted
        })
        .style("fill",function (d) {
            return countries[d.index].color;
        });
    
    //update the paths to match the layout
    groupG.select("path") 
        .transition()
            .duration(1500)
            .attr("opacity",0.5) //optional,just to observe the transition
        .attrTween("d",arcTween( last_layout ))
            .transition().duration(100).attr("opacity",1) //reset opacity
        ;
    
    //create the group labels
    var groupLabel = newGroups.append("svg:text")
        .attr("xlink:href",function (d) {
            return "#group" + d.index;
        })
        .attr("id",function(d,i) { return "group" + d.index; })
        .attr("dy",".35em")
        .attr("color","#fff")
        .text(function (d) {
            return countries[d.index].name;
        })
    groupLabel.append('tspan')
        .text(function (d) {
            return ": $"+decimalPlaceLimit(d.value) + "M";
        })


    //position group labels to match layout
    groupG.select("text")
        .transition()
            .duration(1500)
            .attr("transform",function(d) {
                d.angle = (d.startAngle + d.endAngle) / 2;
                //store the midpoint angle in the data object
                
                return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")" +
                    " translate(" + (innerRadius + 26) + ")" + 
                    (d.angle > Math.PI ? " rotate(180)" : " rotate(0)"); 
                //include the rotate zero so that transforms can be interpolated
            })
            .attr("text-anchor",function (d) {
                return d.angle > Math.PI ? "end" : "begin";
            });


    /* Create/update the chord paths */
    var chordPaths = g.selectAll("path.chord")
        .data(layout.chords(),chordKey );
            //specify a key function to match chords
            //between updates

    //create the new chord paths
    var newChords = chordPaths.enter()
        .append("path")
        .attr("class","chord");
    
    // Add title tooltip for each new chord.
    newChords.append("title");

    //handle exiting paths:
    chordPaths.exit().transition()
        .duration(1500)
        .attr("opacity",0)
        .remove();

    //update the path shape
    chordPaths.transition()
        .duration(1500)
        .attr("opacity",0.5) //optional,just to observe the transition
        .style("fill",function (d) {
            return "url(#" + getGradID(d) + ")"; 
        })
        .attrTween("d",chordTween(last_layout))
        .transition().duration(100).attr("opacity",1) //reset opacity
    ;

    // generates tooltip for the groups
    var tooltip = d3.select("div.tooltip");
    groupG.on("mouseover",function(d) {

        chordPaths.classed("fade",function (p) {
            //returns true if *neither* the source or target of the chord
            //matches the group that has been moused-over
            return ((p.source.index != d.index) && (p.target.index != d.index));
        });
        g.selectAll("path.fade").transition().style("opacity",0);
        var tipSVG = tooltipGenerator(countries[d.index].figure,100-countries[d.index].figure,"#tipDiv",countries[d.index].name,countries[d.index].figure,decimalPlaceLimit(d.value),".textbox",countries[d.index].category,countries[d.index].trend1,countries[d.index].trend2,countries[d.index].trend3 );
        return tooltip.style("visibility","visible");
    })
    groupG.on("mousemove",function(d) {

        return tooltip
            .style("top",(d3.event.pageY + 16) + "px")
            .style("left",(d3.event.pageX  - 200) + "px");
    });
    groupG.on("mouseout",function(d) {
       
        $( "#tipDiv" ).empty();
        $( "#lineChart" ).empty();

        
        chordPaths.classed("nofade",function (p) {
            //returns true if *neither* the source or target of the chord
            //matches the group that has been moused-over
            return ((p.source.index != d.index) && (p.target.index != d.index));
        });
        g.selectAll("path.nofade").transition().style("opacity",1);
     return tooltip.style("visibility","hidden");

    });

    last_layout = layout; //save for next update
}

function arcTween(oldLayout) {
    //this function will be called once per update cycle
    
    //Create a key:value version of the old layout's groups array
    //so we can easily find the matching group 
    //even if the group index values don't match the array index
    //(because of sorting)
    var oldGroups = {};
    if (oldLayout) {
        oldLayout.groups().forEach( function(groupData) {
            oldGroups[ groupData.index ] = groupData;
        });
    }
    
    return function (d,i) {
        var tween;
        var old = oldGroups[d.index];
        if (old) { //there's a matching old group
            tween = d3.interpolate(old,d);
        }
        else {
            //create a zero-width arc object
            var emptyArc = {startAngle:d.startAngle,
                            endAngle:d.startAngle};
            tween = d3.interpolate(emptyArc,d);
        }
        
        return function (t) {
            return arc( tween(t) );
        };
    };
}

function chordKey(data) {
    return (data.source.index < data.target.index) ?
        data.source.index  + "-" + data.target.index:
        data.target.index  + "-" + data.source.index;
}
function chordTween(oldLayout) {

    var oldChords = {};
    
    if (oldLayout) {
        oldLayout.chords().forEach( function(chordData) {
            oldChords[ chordKey(chordData) ] = chordData;
        });
    }
    
    return function (d,i) {
        var tween;
        var old = oldChords[ chordKey(d) ];
        if (old) {
            if (d.source.index != old.source.index ){
                old = {
                    source: old.target,
                    target: old.source
                };
            }
            
            tween = d3.interpolate(old,d);
        }
        else {
            //create a zero-width chord object
            var emptyChord = {
                source: { startAngle: d.source.startAngle,
                         endAngle: d.source.startAngle},
                target: { startAngle: d.target.startAngle,
                         endAngle: d.target.startAngle}
            };
            tween = d3.interpolate( emptyChord,d );
        }

        return function (t) {
            return path(tween(t));
        };
    };
}

// generates the charts inside the group tooltip
function tooltipGenerator(pie1,pie2,target1,name,figure,total,target2,category,trend1,trend2,trend3) {
    var w = 100, h = 100, r = 50;
    data = [{"value":pie1},
            {"value":pie2}];
    
    var vis = d3.select(target1)
        .append("svg:svg")
        .data([data])
            .attr("width",w)
            .attr("height",h)
        .append("svg:g")
            .attr("transform","translate(" + r + "," + r + ")");

    if(category == "donor") {   
         var countryName = d3.select("#countryName")
        .html("<p style='text-align: left; '><span style='font-size: 23px; text-transform: uppercase;color: #264A6B; '>" 
                + name + "</span></p>");
    } else {
         var countryName = d3.select("#countryName")
        .html("<p style='text-align: left; '><span style='font-size: 23px; text-transform: uppercase;color: #fff; '>" 
                + name + "</span></p>");      
    }

    var arc = d3.svg.arc().outerRadius(r);
    var pie = d3.layout.pie().value(function(d) { return d.value; });

    var arcs = vis.selectAll("g.slice")
            .data(pie)
            .enter()
            .append("svg:g")
            .attr("class","slice");
    if(category == "donor") {   
        arcs.append("svg:path")
            .attr("fill",function(d,i) { 
                if (i == 1) {
                    return "#ADD5E1"
                } else {
                    return "#89C0E9"
                }
            } ).attr("d",arc);
    } else {
         arcs.append("svg:path")
            .attr("fill",function(d,i) { 
                if (i == 1) {
                    return "#FEDBB4"
                } else {
                    return "#FBB674"
                }
            } ) 
            .attr("d",arc);       
    }                              


    if(category == "donor"){
        var text = d3.select(target2)
            .html("<p style='text-align: left; '><span style='font-size: 18px;color:#89C0E9; font-weight:bold'>" 
            + figure  + "% unearmarked</span> <br /><span style='font-size: 16px; color: #fff'>Contribution: <br /><strong>$" +
            total + "M</strong></span><br /><span style='font-size: 13px; color: #fff; display:block; line-height:1;margin-top: 7px;'>"+formatPercent(total/262.6)+" of total OCHA donor income</span></p>");
        d3.select(".tooltip").style("background-color","#478AC9").style("width","460px");
    } else {
        var text = d3.select(target2)
            .html("<p style='text-align: left; '><span style='font-size: 18px;color:#FBB674; font-weight:bold;display:block; line-height:1;margin-bottom: 5px'>" 
            + figure  + "% rate of expenditure</span><span style='font-size: 16px; color: #fff'>Received: <br /><strong>$" +
            total + "M</strong></span><br /><span style='font-size: 13px; color: #fff;display:block; line-height:1.1;margin-top: 5px'>"+formatPercent(total/262.6)+" of total OCHA <br />donor donations</span></p>");
        d3.select(".tooltip").style("background-color","#F58233").style("width","290px");
    }

    if(category == "donor") {

        var sparkWidth = 200,sparkHeight = 160,sparkMargin = 25;
        var spark = d3.select("#lineChart").append("svg:svg").attr("width",sparkWidth-(sparkMargin*2)).attr("height",sparkHeight-(sparkMargin*2));

        var d = [trend1,trend2,trend3];
        var years =[2014,2015,2016];
        var formatDay = function(d) {
            return years[d];      
        }

        var xScale = d3.scale.linear().domain([0,d.length]).range([sparkMargin+(sparkMargin*.7),sparkWidth-sparkMargin]);
        var yScale = d3.scale.linear().domain([50,0]).range([0,sparkHeight-(sparkMargin*3)]).nice();

        xAxis = d3.svg.axis().scale(xScale).tickSize(0).ticks(3).tickFormat(formatDay).tickSubdivide(true);
        yAxis = d3.svg.axis().scale(yScale).tickSize(1).ticks(4).orient("left").tickSubdivide(true).innerTickSize(-150);

        spark.append("svg:g")
        .call(xAxis).attr("transform","translate(-2," + (sparkHeight-sparkMargin*2.6) + ")").attr("class","xaxis");
        spark.append("svg:g")
        .call(yAxis).attr("transform","translate(" + (sparkMargin) + "," + 7.8 + ")").attr("class","yaxis");

        var line = d3.svg.line()
            .x(function(d,i) { 
                return xScale(i); 
            })
            .y(function(d) { 
                return  yScale(d); 
            })
        spark.append("svg:path").attr("d",line(d));
    } 
}


/* Activate the buttons and link to data sets */
d3.select("#byCountryButton").on("click",function () {
    countries = d3.csv.parse(d3.select("#countries").text());
    updateChords( "#all_countries" );
    disableButton(this);
});

d3.select("#byRegionButton").on("click",function() {
    countries = d3.csv.parse(d3.select("#regions").text());
    updateChords( "#all_regions" );
    disableButton(this);
});

function disableButton(buttonNode) {
    d3.selectAll("button")
        .attr("disabled",function(d) {
            return this === buttonNode? "true": null;
        });
}
}//]]> 

// initializes the chart by prerssing on "by Region" button
$("document").ready(function() {
    setTimeout(function() {
        $("#byRegionButton").trigger('click');
    },10);
});

</script>
  

</body>
</html>

